# TSJM Analysis Notebook

A web-based interactive notebook for exporting, visualizing, and analyzing **CDF Transformation Job Metrics (TSJM)**.

## What is TSJM?

**Transformation Job Metrics** are performance and operational data generated by CDF (Cognite Data Fusion) Transformations. Each time a transformation runs, it produces metrics including:

- **Resource counts**: How many resources were read, written, created, updated, or deleted. Like RAW, Assets or DM Instances
- **Timing data**: When jobs started, finished, and how long they took
- **Status information**: Whether jobs completed successfully or failed

**Why analyze TSJM?**
- **Performance monitoring**: Identify slow or resource-intensive transformations
- **Concurrency analysis**: Understand when jobs overlap and potentially compete for resources
- **Trend analysis**: Track metrics over time to spot anomalies or degradation. Which can be caused by cluster-performance (product backend) or SQL implementation not following best-practices.
- **Troubleshooting**: Investigate failed jobs and their context

**How is the notebook organized implemented?**

The notebook is organized into chapters, each with a header and a description. In addition the UI is organized in columns.

This notebook created already concrete value in analyzing NOOP (no-operations) metrics,
by identifying transformations with highest impact and validating reduction of NOOP metrics after changes made to the SQL statements.

**How is the notebook implemented?**

The web-ui is built using [marimo.io](https://docs.marimo.io/), a fresh and modern Python driven notebook for building web applications.
It is like a mix of Jupyter Notebook and Streamlit, but with a lot of fresh ideas.

It is recommended to run the notebook in sandbox mode, which installs all dependencies using
the [`uv`](https://docs.astral.sh/uv/) tools. Which is a fresh and modern Python tool for building Python applications.

## Quick Start

```bash
# Run the notebook (requires Python 3.11+)
# tested against marimo 0.19.7
uvx --python 3.13 marimo==0.19.7 run --sandbox --no-token marimo-tsjm-analysis.py
```

For detailed setup instructions, see [README-marimo-analysis.md](README-marimo-analysis.md).

## Features

### Chapter 1: Setup and Configuration
Connect to CDF using your `.env` credentials with support for multiple authentication flows.

### Chapter 2: Export from CDF to disk
Export transformation job metrics from the CDF API with configurable limits, date ranges, and parallel processing.

### Chapter 3: Load Data from disk
Load previously exported JSONL files for offline analysis.

### Chapter 4: TSJM Concurrency Dashboard and Drilldown
Visualize job concurrency patterns to identify scheduling conflicts and resource contention.
- Interactive date range selection
- Peak concurrency detection
- Drill-down into active jobs at any point in time

### Chapter 5: Metrics Dashboard and Drilldown
Analyze transformation metrics trends over time.
- Multi-metric comparison charts
- Transformation-level details
- Trend analysis per transformation

### Chapter 6: Save selected Results
Export analysis results to CSV, Parquet, or JSON formats for further processing.

## Screenshots

*Screenshots coming soon*

<!-- 
TODO: Add anonymized screenshots:
- Chapter 4 concurrency chart
- Chapter 5 metrics dashboard
- Export success summary
-->

## Documentation

- [README-marimo-analysis.md](README-marimo-analysis.md) - Detailed setup and usage guide
- [README-marimo-coding-best-practices.md](README-marimo-coding-best-practices.md) - Development best practices
- [COMMON_JSONL_FORMAT.md](COMMON_JSONL_FORMAT.md) - Data format specification

## Requirements

- Python 3.11+ (tested with Python 3.13)
- CDF project access with transformation READ permissions
- `.env` file with CDF credentials (see [README-marimo-analysis.md](README-marimo-analysis.md#environment-configuration))

## License

TODO: Internal Cognite tool.
